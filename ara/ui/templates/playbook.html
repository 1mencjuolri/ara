{% extends "base.html" %}
{% block body %}
{% include "partials/playbook_card.html" %}
{% load datetime_formatting %}

<div class="pf-c-card" style="margin: 1em 0;">
    <div class="pf-c-card__body">
        <details id="records">
            <summary>Records</summary>
            {% if playbook.items.records %}
            <ul class="pf-c-list">
                {% for record in playbook.records %}
                <li><a href="../record/{{ record.id }}.html">{{ record.key }}</a></li>
                {% endfor %}
            </ul>
            {% else %}
            No records have been saved with <a href="https://ara.readthedocs.io/en/latest/ara-record.html" target="_blank">ara_record</a> for this playbook.
            {% endif %}
        </details>
        <details id="files">
            <summary>Files</summary>
            <ul class="pf-c-list">
                {% for file in playbook.files %}
                <li><a href="../file/{{ file.id }}.html">{{ file.path }}</a></li>
                {% endfor %}
            </ul>
        </details>
        <details id="hosts" open="true">
            <summary>Hosts</summary>
            <table class="pf-c-table pf-m-grid-md pf-m-compact" role="grid" id="host-table">
                <thead>
                    <tr>
                        <th>Host</th>
                        <th>Changed</th>
                        <th>Failed</th>
                        <th>Ok</th>
                        <th>Skipped</th>
                        <th>Unreachable</th>
                    </tr>
                </thead>
                <tbody>
                    {% for host in playbook.hosts %}
                    <tr>
                        <td><a href="../host/{{ host.id }}.html">{{ host.name }}</a></td>
                        <td>{{ host.changed }}</td>
                        <td>{{ host.failed }}</td>
                        <td>{{ host.ok }}</td>
                        <td>{{ host.skipped }}</td>
                        <td>{{ host.unreachable }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </details>
        <details id="results" open="true">
            <summary>Task results</summary>
            <table class="pf-c-table pf-m-grid-md pf-m-compact" role="grid" id="result-table">
                <thead>
                    <tr role="row">
                        <th role="columnheader" scope="col" class="pf-m-fit-content">Status</th>
                        <th role="columnheader" scope="col" class="pf-m-fit-content">
                            Date
                        </th>
                        <th role="columnheader" scope="col" class="pf-m-fit-content">
                            Duration
                        </th>
                        <th role="columnheader" scope="col">Task</th>
                        <th role="columnheader" scope="col">Action</th>
                        <th role="columnheader" scope="col">Host</th>
                    </tr>
                </thead>
                <tbody>
                    {% for play in playbook.plays %}
                    {% for task in play.tasks %}
                    {% for result in task.results %}
                    <tr role="row">
                        <td role="cell" data-label="Status" class="pf-c-table__icon pf-m-fit-content">
                            {% include "partials/result_status_icon.html" with status=result.status %}
                        </td>
                        <td role="cell" data-label="Date" class="pf-m-fit-content">
                            {{ result.started | format_date }}
                        </td>
                        <td role="cell" data-label="Duration" class="pf-m-fit-content">
                            {{ result.duration | format_duration }}
                        </td>
                        <td role="cell" data-label="Name" class="pf-m-fit-content">
                            <a href="../result/{{ result.id }}.html">{{ task.name }}</a>
                        </td>
                        <td role="cell" data-label="Action" class="pf-m-fit-content">
                            <a href="../file/{{ task.file.id }}.html#{{ task.lineno }}">{{ task.action }}</a>
                        </td>
                        <td role="cell" data-label="Host" class="pf-m-fit-content">
                            {{ result.host.name }}
                        </td>
                    </tr>
                    {% endfor %}
                    {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </details>
    </div>
</div>
{% endblock %}
