- job:
    name: ara-tox-py3
    parent: tox
    nodeset: ubuntu-bionic
    vars:
      tox_envlist: py3

- job:
    name: ara-tox-linters
    parent: tox
    nodeset: ubuntu-bionic
    vars:
      tox_envlist: linters

- job:
    name: ansible-role-ara-tests-base
    parent: base
    vars:
      integration_ansible_name: "{{ ansible_user_dir }}/src/github.com/ansible/ansible"
      integration_ansible_version: null
    run: playbooks/ara_tests.yaml
    post-run: tests/ara_tests_post.yaml

- job:
    name: ansible-role-ara-tests-fedora-devel
    parent: ansible-role-ara-tests-base
    nodeset: fedora-latest
    required-projects:
      - name: github.com/ansible/ansible
        override-checkout: devel

- job:
    name: ansible-role-ara-tests-fedora-2.7
    parent: ansible-role-ara-tests-base
    nodeset: fedora-latest
    required-projects:
      - name: github.com/ansible/ansible
        override-checkout: stable-2.7

- job:
    name: ansible-role-ara-tests-ubuntu-2.6
    parent: ansible-role-ara-tests-base
    nodeset: ubuntu-bionic
    required-projects:
      - name: github.com/ansible/ansible
        override-checkout: stable-2.6

- job:
    name: ansible-role-ara-api-base
    parent: base
    files:
      - ara/*
      - playbooks/*
      - roles/*
      - tests/*
      - .zuul.d/*
      - setup.py
      - setup.cfg
      - requirements.txt
      - test-requirements.txt
    pre-run: tests/role-integration-pre.yaml
    run: playbooks/ara_api.yaml
    vars:
      ara_api_source: "{{ ansible_user_dir }}/src/git.openstack.org/openstack/ara"
      ansible_python_interpreter: /usr/bin/python3

- job:
    name: ansible-role-ara-api-ubuntu
    parent: ansible-role-ara-api-base
    nodeset: ubuntu-bionic

- job:
    name: ansible-role-ara-api-fedora
    parent: ansible-role-ara-api-base
    nodeset: fedora-latest

- job:
    name: ansible-role-ara-web-base
    parent: base
    files:
      # ara
      - ara/*
      - playbooks/*
      - roles/*
      - tests/*
      - .zuul.d/*
      - setup.py
      - setup.cfg
      - requirements.txt
      - test-requirements.txt
      # ara-web
      - src/.*
      - public/.*
      - package.json
      - package-lock.json
    required-projects:
      - openstack/ara-web
    run: playbooks/ara_web.yaml
    post-run: tests/role-ara-web-post.yaml
    vars:
      ara_web_source: "{{ ansible_user_dir }}/src/git.openstack.org/openstack/ara-web"
      ara_web_api_server: "https://api.demo.recordsansible.org"
      ansible_python_interpreter: /usr/bin/python3

- job:
    name: ansible-role-ara-web-ubuntu
    parent: ansible-role-ara-web-base
    nodeset: ubuntu-bionic

- job:
    name: ansible-role-ara-web-fedora
    parent: ansible-role-ara-web-base
    nodeset: fedora-latest

- project:
    vars:
      rtd_webhook_id: '49230'
    templates:
      - docs-on-readthedocs
    check:
      jobs:
        - ansible-role-ara-tests-fedora-2.7
        - ansible-role-ara-tests-fedora-devel:
            voting: false
        - ansible-role-ara-tests-ubuntu-2.6
        - ansible-role-ara-api-ubuntu
        - ansible-role-ara-api-fedora
        - ansible-role-ara-web-ubuntu
        - ansible-role-ara-web-fedora
        - ara-tox-linters
        - ara-tox-py3
    gate:
      jobs:
        - ansible-role-ara-tests-fedora-2.7
        - ansible-role-ara-tests-ubuntu-2.6
        - ansible-role-ara-api-ubuntu
        - ansible-role-ara-api-fedora
        - ansible-role-ara-web-ubuntu
        - ansible-role-ara-web-fedora
        - ara-tox-linters
        - ara-tox-py3
